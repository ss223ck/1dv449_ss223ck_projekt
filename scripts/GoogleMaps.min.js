"use strict";function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:56.663593,lng:16.355325},zoom:8})}function startScripts(){document.getElementById("counties").addEventListener("change",getSCBCommunes),document.getElementById("submitbutton").addEventListener("click",getBooliHousings)}function getSCBCommunes(){if("object"==typeof google&&"object"==typeof google.maps){var e,n=document.getElementById("counties").value;null==localStorage[n]?$.ajax({type:"POST",url:"index.php",data:{county:n},success:function(t){e=JSON.parse(t),createCommuneOptions(e),localStorage[n]=t},error:function(){emptyErrorResults(),createErrorMessage("Fel när data skulle hämtas från servern");var e=document.getElementById("communes"),n=document.getElementById("tableForInformationAboutHousing");n.innerHTML="",e.innerHTML=""}}):createCommuneOptions(JSON.parse(localStorage[n]))}else createErrorMessage("Google maps laddades inte in korrekt, försök ladda om sidan eller testa igen senare.")}function createCommuneOptions(e){var n=document.getElementById("communes");n.innerHTML="";for(var t in e){var o=document.createElement("option");o.value=e[t],o.innerHTML=t,n.appendChild(o)}}function getBooliHousings(){if("object"==typeof google&&"object"==typeof google.maps){var e,n=document.getElementById("communes").value;$.ajax({type:"POST",url:"index.php",data:{commune:n},success:function(t){e=JSON.parse(t),"string"===$.type(e[0])||"string"===$.type(e[1])?(emptyErrorResults(),displayErrorMessage(e)):(renderHousingData(e),localStorage[n]=JSON.stringify(e[1]))},error:function(){emptyErrorResults(),createErrorMessage("Fel när data skulle hämtas från servern");var e=document.getElementById("tableForInformationAboutHousing");if(e.innerHTML="",null!=localStorage[n]){var t=JSON.parse(localStorage[n]);renderScbInformation(t.dataset)}}})}else createErrorMessage("Google maps laddades inte in korrekt, försök ladda om sidan eller testa igen senare.")}function displayErrorMessage(e){createErrorMessage(e[0]),createErrorMessage(e[1])}function emptyErrorResults(){var e=document.getElementById("errorDisplayWrapper");e.innerHTML=""}function createErrorMessage(e){if("string"===$.type(e)){var n=document.createElement("p"),t=document.getElementById("errorDisplayWrapper");n.innerHTML=e,n.className="errorMessage",t.appendChild(n)}}function renderHousingData(e){var n=document.getElementById("errorDisplayWrapper");n.innerHTML="";for(var t in e[0].listings)renderHousingObjects(e[0].listings[t]);renderScbInformation(e[1].dataset)}function renderScbInformation(e){var n=document.getElementById("tableForInformationAboutHousing"),t=document.createElement("thead"),o=document.createElement("tr"),r=document.createElement("th"),a=document.createElement("th");n.innerHTML="",a.innerHTML=first(e.dimension.Tid.category.label),o.appendChild(r),o.appendChild(a),t.appendChild(o),n.appendChild(t);var i=[];for(var s in e.dimension.Hustyp.category.index)i[e.dimension.Hustyp.category.index[s]]=s;for(var s in e.dimension.Hustyp.category.label)s==i[0]?i[0]=e.dimension.Hustyp.category.label[s]:s==i[1]?i[1]=e.dimension.Hustyp.category.label[s]:s==i[2]?i[2]=e.dimension.Hustyp.category.label[s]:i[3]=e.dimension.Hustyp.category.label[s];for(var d=document.createElement("tbody"),l=0;4>l;l++){var o=document.createElement("tr"),c=document.createElement("td"),m=document.createElement("td");c.innerHTML=i[l],m.innerHTML=e.value[l],o.appendChild(c),o.appendChild(m),d.appendChild(o)}n.appendChild(d)}function first(e){for(var n in e)return n}function renderHousingObjects(e){infowindow=new google.maps.InfoWindow({content:""});var n=new google.maps.Marker({position:{lat:e.location.position.latitude,lng:e.location.position.longitude},map:map,title:e.location.address.streetAddress}),t=new google.maps.LatLng(e.location.position.latitude,e.location.position.longitude);map.panTo(t);var o='<div id="content"><div id="siteNotice"></div><div id="heading"><h1 id="firstHeading" class="firstHeading">'+e.location.address.streetAddress+'</h1></div><div id="bodyContent"><p> Typ av boende: '+e.objectType+"</p><p>Antal rum: "+e.rooms+"</p><p>Boarea: "+e.livingArea+" kvadratmeter</p><p>Pris i kr: "+e.listPrice+'</p><a href="'+e.url+'">Till objektets webbplats</a></div></div>';n.addListener("click",function(){infowindow.close(),infowindow=new google.maps.InfoWindow({content:""}),infowindow.content=o,infowindow.open(map,n)}),document.getElementById("submitbutton").addEventListener("click",function(){n.setMap(null)})}var map,infowindow;window.onLoad=startScripts();